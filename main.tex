% author:   sam tenka
% change:   2023-11-06
% create:   2023-10-28


\documentclass[justified]{tufte-book}

%\usepackage{caption}
%\captionsetup{compatibility=false}

\usepackage[framemethod=tikz]{mdframed}
\geometry{
  left           = 0.90in, % left margin
  textwidth      = 4.95in, % main text block
  marginparsep   = 0.15in, % gutter between main text block and margin notes
  marginparwidth = 2.30in, % width of margin notes
                 % 0.20in  % width from margin to edge
}
\input{sam.sty}

% thanks to https://tex.stackexchange.com/questions/548365
%\setlength{\JustifyingParindent}{0pt}
\makeatletter
\renewcommand{\@tufte@margin@par}{%
  \setlength{\RaggedRightParindent}{0.5pc}%
  \setlength{\JustifyingParindent}{0pc}%
  \setlength{\parindent}{0.5pc}%
  \setlength{\parskip}{0pt}%
}
\makeatother



\usepackage{fancyhdr}
\newcommand{\whichsect}{} % blank (uninitialized)
\fancyhead[RO,RE]{{\large\whichsect}}

%\usepackage[T1]{fontenc}
%\usepackage{lmodern}
%% FONT SIZE
%\newcommand{\moofont}{%
%\fontsize{12}{13}\selectfont
%}
%\AtBeginDocument{\moofont}%

% thanks to https://tex.stackexchange.com/questions/106416
\usepackage{etoolbox}
\makeatletter
\patchcmd{\@caption}
  {\noindent\csname fnum@#1\endcsname: \ignorespaces}
  {}
  {}{}
\makeatother

\newcommand{\fig}[2]{%
  \begin{marginfigure}%
  \includegraphics[width=\textwidth]{#1}%
  %\caption{\scriptsize{#2}}%
  \noindent{\scriptsize{#2}}
  \end{marginfigure}%
}

%\newcommand{\aud}[2]{%
%\begin{fullwidth}%
%\includegraphics[width=\textwidth]{#1}\\%
%\noindent{\scriptsize{#2}}%
%\end{fullwidth}%
%}
\newcommand{\aud}[2]{%
\begin{fullwidth}%
\begin{figure}[h]\centering
\includegraphics[width=\textwidth]{#1}%
#2
\end{figure}
\end{fullwidth}%
}

\newcommand{\audio}[1]{%
  \attnsam{AUDIO MISSING}
}

%\newcommand{\moobeginvid}{\begin{fullwidth}\centering}
%\newcommand{\mooendvideo}{\setfloatalignment{b}\end{fullwidth}}

\newcommand{\moobeginvid}{\begin{figure}[h]\centering}
\newcommand{\mooendvideo}{\end{figure}}


\newcommand{\vidframe}[2]{%
\includegraphics[width= #1 \textwidth]{#2}%
}


\newcommand{\sectionreferences}{\sampassage{references}}

% thanks to tex.stackexchange.com/questions/352596
\usepackage{marginfix} % to fix tufte margin items falling off page

%% thanks to https://tex.stackexchange.com/questions/83509
%\makeatletter
%%\newcommand{\pushright}[1]{\ifmeasuring@#1\else\omit\hfill$\displaystyle#1$\fi\ignorespaces}
%\newcommand{\pushright}[1]{\hfill$$\displaystyle#1$$\ignorespaces}
%\newcommand{\pushleft}[1]{\ifmeasuring@#1\else\omit$\displaystyle#1$\hfill\fi\ignorespaces}
%\makeatother

\begin{document}\samtitle{%
  EUPHONICS, by Jim Woodhouse}
  \marginnote[+.6cm]{%
    \par This text is an experiment and a work in progress by Jim Woodhouse
    (\texttt{jimwoodhouse74@gmail.com}). The intention is to give a multi-level
    description of the science of musical instruments.
    %
    It's available for free and with lots of audio, video, and external links
    not present in this pdf at \texttt{euphonics.org/homepage}.
    %
    %Jim has worked in the Cambridge University Engineering Department in
    %England since 1986.  His interests are in the modelling, measurement and
    %prediction of vibration in complex structures, including musical
    %instruments.  His interest in the violin started from a hobby interest in
    %building instruments.
    %
    \par Sam Tenka (\texttt{samtenka@mit.edu}) compiled Jim's writing into a
    pdf.
  }

  \emergencystretch 3em
  \input{all-contents.tex}

  \renewcommand*{\tag}[1]{%              % ams overrides for equation environs
    \quad\quad\text{\hfill}\quad\quad(#1)% but NOT for in-line math
  }                                      %
  \input{all-input.tex}
\end{document}
